<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Rotate a shape about an arbitrary point  &middot; ZYBNET</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="canvas, html5, javascript, ">


<meta property="og:title" content="Rotate a shape about an arbitrary point  &middot; ZYBNET ">
<meta property="og:site_name" content="ZYBNET"/>
<meta property="og:url" content="https://www.zybnet.com/2012/03/14/rotate-a-shape-about-an-arbitrary-point/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2012-03-14T23:31:25Z" />
<meta property="og:article:modified_time" content="2012-03-14T23:31:25Z" />

  
    
<meta property="og:article:tag" content="canvas">
    
<meta property="og:article:tag" content="html5">
    
<meta property="og:article:tag" content="javascript">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@raffaelesgarro" />
<meta name="twitter:creator" content="@raffaelesgarro" />
<meta name="twitter:title" content="Rotate a shape about an arbitrary point" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://www.zybnet.com/2012/03/14/rotate-a-shape-about-an-arbitrary-point/" />
<meta name="twitter:domain" content="https://www.zybnet.com/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Rotate a shape about an arbitrary point",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2012-03-14",
    "description": "",
    "wordCount": 426
  }
</script>



<link rel="canonical" href="https://www.zybnet.com/2012/03/14/rotate-a-shape-about-an-arbitrary-point/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.zybnet.com/touch-icon-144-precomposed.png">
<link href="https://www.zybnet.com/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.19" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://www.zybnet.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://www.zybnet.com/css/style.css">
<link rel="stylesheet" href="https://www.zybnet.com/css/highlight/default.css">

  
</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://www.zybnet.com/">
  ZYBNET

</a>

</div>

  
<div class="container topline">
  
  My hacking journal


</div>


</div>

  <nav class="container nav primary no-print">
  

<a class="homelink" href="https://www.zybnet.com/">Home</a>


  
<a href="https://www.zybnet.com/about">About</a>

<a href="https://www.zybnet.com/post" title="Show list of posts">Posts</a>

<a href="https://www.zybnet.com/tags" title="Show list of tags">Tags</a>

<a href="https://www.zybnet.com/zuml" title="ZUML">ZUML</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:raffaeleSgarro@gmail.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/RaffaeleSgarro/raffaelesgarro.github.io">
  <span class="fa fa-github-square"></span><span>github</span></a>









<a id="contact-link-facebook" class="contact_link" href="https://www.facebook.com/raffaelesgarro">
  <span class="fa fa-facebook-square"></span><span>facebook</span></a>



<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/raffaelesgarro">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>







<a id="contact-link-stackoverflow" class="contact_link" href="https://stackoverflow.com/users/315306">
  <span class="fa fa-stack-overflow"></span><span>stackoverflow</span></a>



</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Rotate a shape about an arbitrary point
</h1>

  <div class="metas">
<time datetime="2012-03-14">14 Mar, 2012</time>


  
    &middot; by admin
  
  &middot; Read in about 2 min
  &middot; (426 Words)
  <br>
  
<a class="label" href="https://www.zybnet.com/tags/canvas">canvas</a>

<a class="label" href="https://www.zybnet.com/tags/html5">html5</a>

<a class="label" href="https://www.zybnet.com/tags/javascript">javascript</a>



</div>

</header>

  <div class="container content">
  <p>I wrote this to answer <a href="http://stackoverflow.com/q/9701784/315306">a question on StackOverflow</a>.
It&rsquo;s a piece of Javascript code to rotate an object around an arbitrary point. I underestimated the complexity
of this problem and found no available solution online. To be honest, the objective is quite simple to achieve,
but neverthless it made me review trigonometry and linear algebra and exercise the canvas API.
Here is <a href="http://jsfiddle.net/raffaele181188/Cfdcn/">the original JSFiddle</a> and this is the final result:</p>

<p><img src="/images/rotate.png" alt="Rotate rectangle" /></p>

<p></p>

<p>Here the code</p>

<pre><code>/*
 * This demo program draws a rectangle rotated
 * about a pivot point for the amount &quot;gamma&quot;
 *
 */
var context = document.getElementById(&quot;canvas&quot;).getContext(&quot;2d&quot;);
// rectangle's dimensions
var width = 75;
var height = 35;
// rotation angle
var gamma = 45 * Math.PI / 180;
// the pivot coordinates
var x = 200;
var y = 170;

// Some padding
context.translate(100, 100);

// Draw a rectangle in (0,0) and

function draw(color) {
    context.strokeStyle = color;
    context.lineWidth = 4;
    // Random offset
    context.strokeRect(23, 13, width, height);
    arrow(0, 0, width * 1.5, 0, color);
    arrow(0, 0, 0, height * 1.5, color);
}

function sqr(number) {
    return number * number;
}

function distance(x1, y1, x2, y2) {
    return Math.sqrt(sqr(x1 - x2) + sqr(y1 - y2));
}

// Draw an arrow from (x1, y1) to (x2, y2)

function arrow(x1, y1, x2, y2, color) {
    context.strokeStyle = color || &quot;#0b0&quot;;
    context.lineWidth = 1;
    // draw the line
    context.beginPath();
    context.moveTo(x1, y1);
    context.lineTo(x2, y2);
    context.stroke();
    context.closePath();
    // draw the head
    context.save();
    context.translate(x2, y2);
    m = distance(x1, y1, x2, y2);
    sin = (y2 - y1) / m;
    cos = (x2 - x1) / m;
    alpha = Math.asin(sin);
    if (alpha &gt; 0 &amp;&amp; cos &lt; 0) alpha = Math.PI - alpha;
    if (alpha &lt; 0 &amp;&amp; cos &lt; 0) alpha = -Math.PI + Math.abs(alpha);
    context.rotate(alpha);
    context.beginPath();
    context.moveTo(0, 0);
    context.lineTo(-5, 2);
    context.moveTo(0, 0);
    context.lineTo(-5, -2);
    context.stroke();
    context.closePath();
    context.restore();
}

// Draw the base rectangle with grey
draw(&quot;#bbb&quot;);

// Rotate about an arbitrary point (red)
// 1. normalize
magnitude = Math.sqrt(x * x + y * y);
senA = -y / magnitude;
cosA = -x / magnitude;

// 2. compute the sin and cos of (alpha + gamma)
senAG = Math.cos(gamma) * senA + Math.sin(gamma) * cosA;
cosAG = Math.cos(gamma) * cosA - Math.sin(gamma) * senA;

// 3. Back to the old coordinate space
originTranslatedX = cosAG * magnitude + x;
originTranslatedY = senAG * magnitude + y;

// Draw arrows to show the rotation of the origin
// about the pivot point for the specified amount
arrow(x, y, 0, 0);
arrow(x, y, originTranslatedX, originTranslatedY);
context.save();
context.translate(originTranslatedX, originTranslatedY);
context.rotate(gamma);
draw(&quot;#b00&quot;);
context.restore();â€‹
</code></pre>
</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="https://www.zybnet.com/2012/03/14/join-multidimensional-array-elements-with-a-ruby-oneliner/" title="Join multidimensional array elements with a Ruby oneliner">
      Previous
    </a>
    

    
    <a class="next" href="https://www.zybnet.com/2012/03/16/multiple-substitutions-with-sed/" title="Multiple substitutions with sed">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//zybnet.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  
<a href="http://www.wtfpl.net/txt/copying/">Do What The Fuck You Want To Public License</a>


  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  

</div>


  

</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//zybnet.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="https://www.zybnet.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




    
  </body>
</html>

